groups:
- name: Demo Alerts
  rules:

  # Alert for any instance that is unreachable for >1 minute.
  - alert: service_down
    expr: up == 0
    for: 1m
    labels:
      severity: page
    annotations:
      summary: "'{{ $labels.instance }}' down"
      description: "'{{ $labels.instance }}' of job '{{ $labels.job }}' has been down for more than 2 minutes."

  - alert: node_high_memory_usage
    expr: (((node_memory_MemTotal_bytes-node_memory_MemFree_bytes-node_memory_Cached_bytes)/(node_memory_MemTotal_bytes)*100)) > 30
    for: 1m
    labels:
      severity: page
    annotations:
      summary: "'{{ $labels.instance }}' under high memory usage"
      description: "Node '{{ $labels.instance }}': Memory usage is above 30% (current value is: {{ $value }})."

  - alert: preso_high_memory_usage
    expr: container_memory_max_usage_bytes{name=~"preso-app.*"} / 1000000 > 2.5
    for: 1m
    labels:
      severity: page
    annotations:
      summary: "'{{ $labels.name }}' has high Memory usage"
      description: "Container '{{ $labels.name }}': Memory usage > 2.5 MB (current value is: {{ $value }})."

  - alert: preso_high_cpu_usage
    expr: rate(container_cpu_user_seconds_total{name=~"preso-app.*"}[30s]) * 100 > 0
    for: 1m
    labels:
      severity: page
    annotations:
      summary: "'{{ $labels.name }}' has high cpu usage"
      description: "Container '{{ $labels.name }}': CPU usage > 0% (current value is: {{ $value }})."